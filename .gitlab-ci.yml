
stages:
  - codegen
  - build
  - benchmark
  - package

codegen-job:
  tags:
    - matlab
  stage: codegen
  script:
    - "make asr.zip"
  artifacts:
    paths:
      - asr.zip

build-job:
  tags:
    - pi
  stage: build
  dependencies:
    - codegen-job
  script:
    - "unzip -o -d codegen asr.zip"
    - "touch codegen/.directory" 
    - "make"
  artifacts:
    paths:
      - asr.so

package-job:
  tags:
    - linux
  stage: package
  dependencies:
    - build-job
  script:
    - "ls -l"
    - "make deb"

package-pi-job:
  tags:
    - pi
  stage: package
  dependencies:
    - build-job
  script:
    - "ls -l"
    - "make deb"


benchmark-job:
  tags:
    - pi
  stage: benchmark
  script:
    - "unzip -o asr.zip -d codegen"
    - "touch codegen/.directory"
    - "g++ --version"
    - "make benchmark"
    - "ulimit -c unlimited"
    - "./benchmark --benchmark_out_format=console --benchmark_out=benchmark.log"
